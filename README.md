<p align="center">
      <a href="https://github.com/blueberryapple/clean-fast-api/actions/workflows/ci.yml"><img alt="clean-fast-api status" src="https://github.com/blueberryapple/clean-fast-api/actions/workflows/ci.yml/badge.svg?branch=main"></a>
</p>

# clean-fast-api

This microservice follow clean architecture. It mainly serves as an example for serving ml models.The code has separate concerns for the routing, business logic, and data retrieval.

## Technical details

It uses fastapi to create the http server and inject dependencies such as the `FlowerRepository` and `FlowerService`. The repository layer pulls in predictions from a random forrest classifier generated by `flower/create_iris_model.py` and trained on the [sklearn iris dataset](https://scikit-learn.org/stable/datasets/toy_dataset.html#iris-dataset).

## CI/CD

It uses GitHub actions to statically typecheck the codebase using [`pyright`](https://github.com/Microsoft/pyright). We bundle `pyright` in our repository through Yarn PnP in addition to caching Python dependencies to speed up the run time.

## Running the server

We use `pyenv` for managing our Python versions:

```sh
# set up virtual env
pyenv virtualenv 3.10.2 clean-fast-api
pyenv activate clean-fast-api

# install dependencies and run server
pip3 install -r requirements.txt
uvicorn main:app
```

If you don't use `pyenv`, make sure you match our Python version `3.10.2`.
